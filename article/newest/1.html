
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <h1 style="background-color: inherit;"><strong
            style="background-color: inherit; color: rgb(255, 102, 0); font-size: 18pt;">定义</strong></h1>
    <hr style="background-color: inherit;">
</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    OSGi(Open Service Gateway Initiative)技术是面向Java的动态模型系统。
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    这个框架实现了一个优雅、完整和动态地组价模型。应用程序（称为bundle）无序重新引导可以被远程安装、启动、升级和卸载。<br style="background-color: inherit;"></p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    OSGi服务平台提供在多种网络设备上无需重启的动态改变构造的功能。
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    为了最小化耦合度和促使这些耦合度可管理，OSGi技术提供一种面向服务的架构，它能使这些组件动态地发现对方。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    OSGi联盟已经开发了例如像HTTP服务器、配置、日志、安全、用户管理、XML等很多公共功能标准组件接口。这些组件的兼容性插件实现可以从进行了不同优化和使用代价的不同计算机服务提供商得到。然而，服务接口能够基于专有权基础上开发。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit;">OSGi的主要职责就是为了让开发者能够创建动态化、模块化的Java系统。</strong></p><br
        style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-align: right;">
    <a style="background-color: inherit; cursor: pointer;"
       href="http://www.cnblogs.com/jingmoxukong/p/4546947.html#_labelTop">回到顶部</a></div>
<h1 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit; color: rgb(255, 102, 0); font-size: 18pt;">OSGi 框架</strong></h1>
<hr style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    OSGi框架从概念上可以分为三层：模块层、生命周期层和服务层。</p>
<ul style="margin-top: 0px; margin-bottom: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <li style="background-color: inherit;">Module Layer：模块层主要涉及包及共享的代码；</li>
    <li style="background-color: inherit;">Lifecycle Layer：生命周期层主要涉及Bundle的运行时生命周期管理；</li>
    <li style="background-color: inherit;">Service Layer：服务层主要涉及模块之间的交互和通信。</li>
</ul>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <img width="479" height="374"
         style="background-color: inherit; cursor: default; display: inline-block; margin-top: 8px; max-width: 800px;"
         data-attr-org-img-file="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/b505c70be00148c29a54a74e9f45c942/175002_mip6.jpeg"
         data-attr-org-src-id="6A4EAC75415A4DE1ABBE6315CDD34C97" data-media-type="image" alt="图 1. OSGi 层次结构"
         src="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/b505c70be00148c29a54a74e9f45c942/175002_mip6.jpeg">
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    &nbsp;</p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-align: right;">
    <a style="background-color: inherit; cursor: pointer;"
       href="http://www.cnblogs.com/jingmoxukong/p/4546947.html#_labelTop">回到顶部</a></div>
<h1 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit; color: rgb(255, 102, 0); font-size: 18pt;">模块层</strong></h1>
<hr style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    模块层是 OSGi 框架中最基础的部分。<br style="background-color: inherit;"></p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    OSGi 的模块化，是通过为 Jar 包添加metadata 来定义哪些类该暴露，哪些类该隐藏，其控制单元叫做 Bundle（jar 包）。<span
        class="Apple-converted-space">&nbsp;</span><br style="background-color: inherit;"></p>

<h2 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit;"><span
            style="background-color: inherit; color: rgb(51, 102, 255); font-size: 14pt;">Bundle</span></strong></h2>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    首先，必须先了解一个基本概念&mdash;&mdash;什么是Bundle？</p>
<fieldset
        style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <legend style="background-color: inherit;"><strong style="background-color: inherit;">什么是 Bundle ?</strong><br
            style="background-color: inherit;"></legend>
    <div style="background-color: inherit;"><strong
            style="background-color: inherit; color: rgb(128, 0, 0);">bundle</strong><span
            class="Apple-converted-space">&nbsp;</span>是以 jar
        包形式存在的一个模块化物理单元，里面包含了代码，资源文件和元数据（metadata），并且jar包的物理边界也同时是运行时逻辑模块的封装边界。
    </div>
</fieldset>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <img style="background-color: inherit; cursor: default; display: inline-block; margin-top: 8px; max-width: 800px;"
         data-attr-org-img-file="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/755354333ed746f496bb608f9284eb0e/module2.png"
         data-attr-org-src-id="CB6262C9D114459891195C9DDDBC5791" data-media-type="image" alt="bundle"
         src="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/755354333ed746f496bb608f9284eb0e/module2.png">
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <br style="background-color: inherit;"></p>

<h2 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit; color: rgb(51, 102, 255); font-size: 14pt;">如何定义 Bundle</strong><br
        style="background-color: inherit; color: rgb(51, 102, 255);"></h2>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    Bundle 是 OSGi 中的基本组件，其表现形式仍然为 Java 概念中传统的 Jar 包。
</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    通过<span class="Apple-converted-space">&nbsp;</span><strong
        style="background-color: inherit; color: rgb(255, 0, 0);">META-INF</strong><span class="Apple-converted-space">&nbsp;</span>目录下的<span
        class="Apple-converted-space">&nbsp;</span><strong style="background-color: inherit; color: rgb(255, 0, 0);">MANIFEST.MF</strong><span
        class="Apple-converted-space">&nbsp;</span>文件对其予以进一步的定义。
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    通常一个 MANIFEST.MF 文件的内容如下：<br style="background-color: inherit;"></p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <a style="background-color: inherit; cursor: pointer;" title="复制代码"><img
            style="background-color: inherit; cursor: default; display: inline-block; margin-top: 8px; max-width: 800px;"
            data-attr-org-img-file="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/0f54386e002745588d027f80468c5878/copycode.gif"
            data-attr-org-src-id="02CC54D96E59439D87C2F0CBB294710A" data-media-type="image" alt="复制代码"
            src="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/0f54386e002745588d027f80468c5878/copycode.gif"></a>
</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    Manifest-Version:&nbsp;1.0<br style="background-color: inherit;">Bundle-ManifestVersion:&nbsp;2<br
        style="background-color: inherit;">Bundle-Name:&nbsp;Util<br style="background-color: inherit;">Bundle-SymbolicName:&nbsp;com.ibm.director.la.util<br
        style="background-color: inherit;">Bundle-Version:&nbsp;1.0.0<br style="background-color: inherit;">Bundle-RequiredExecutionEnvironment:&nbsp;J2SE-1.5<br
        style="background-color: inherit;">Import-Package:&nbsp;org.osgi.framework;version="1.3.0"<br
        style="background-color: inherit;">Export-Package:&nbsp;com.ibm.director.la.util;uses:="org.osgi.framework"<br
        style="background-color: inherit;">Bundle-ClassPath:&nbsp;lib/junit.jar,
</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <a style="background-color: inherit; cursor: pointer;" title="复制代码"><img
            style="background-color: inherit; cursor: default; display: inline-block; margin-top: 8px; max-width: 800px;"
            data-attr-org-img-file="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/0f54386e002745588d027f80468c5878/copycode.gif"
            data-attr-org-src-id="02CC54D96E59439D87C2F0CBB294710A" data-media-type="image" alt="复制代码"
            src="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/0f54386e002745588d027f80468c5878/copycode.gif"></a>
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    MANIFEST.MF 文件存储的实际上是 Bundle 的元数据。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    元数据的内容可以精确的定义 Bundle 的各种特征，同时能更好的对 Bundle 进行标识同时帮助用户对Bundle进行理解。<br style="background-color: inherit;"></p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    &nbsp;</p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-align: right;">
    <a style="background-color: inherit; cursor: pointer;"
       href="http://www.cnblogs.com/jingmoxukong/p/4546947.html#_labelTop">回到顶部</a></div>
<h1 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit;"><span
            style="background-color: inherit; color: rgb(255, 102, 0); font-size: 18pt;">生命周期层</span></strong></h1>
<hr style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    生命周期层在OSGi框架中属于模块层上面的一层，它的运作是建立在模块层的功能之上的。
</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit;">生命周期层的主要功能是控制动态安装、开启、关闭、更新和卸载的bundles。</strong></div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    生命周期层让你能够从外部管理应用或者建立能够自我管理的应用（或者两者的结合），并且给了应用本身很大的动态性。<span class="Apple-converted-space">&nbsp;</span><br
        style="background-color: inherit;"></p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    前面已经了解了 Bundle 的概念和作用。但是要真正使用 Bundle，需要使用生命周期层的API，来和OSGi框架的生命周期层进行交互。</p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    在 标准的Java编程中，可以通过将jar包放到classpath中来使用它。而bundle则不是这样，Bundle只有在被安装（install）到
    一个OSGi框架的运行实例中才能用起来。并且OSGi框架支持对这些bundle完整的生命周期管理，并且支持这些管理操作在应用执行完成。
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    下图为 Bundle 生命周期的状态转移图：<span class="Apple-converted-space">&nbsp;</span><br style="background-color: inherit;"></p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    &nbsp;</p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <img style="background-color: inherit; cursor: default; display: inline-block; margin-top: 8px; max-width: 800px;"
         data-attr-org-img-file="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/330300506bd540308f6d9c31d06ebe32/lifecycle2.png"
         data-attr-org-src-id="AF84FD72244B49E1B6EC48B406400A0A" data-media-type="image"
         alt="http://assets.osgi.com.cn/article/7289216/lifecycle2.png"
         src="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/330300506bd540308f6d9c31d06ebe32/lifecycle2.png">
</div>
<span style="color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;">&nbsp;</span>

<h2 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit;"><span
            style="background-color: inherit; color: rgb(51, 102, 255); font-size: 14pt;">重要接口</span></strong><br
        style="background-color: inherit; color: rgb(51, 102, 255);"></h2>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    生命周期层的API主要是由以下三个核心接口来组成的：BundleActivator，BundleContext 和 Bundle。<br style="background-color: inherit;">
    <ul style="margin-top: 0px; margin-bottom: 0px; background-color: inherit;">
        <li style="background-color: inherit;">BundleActivator：让你能够捕捉bundle的start和stop事件，并对这两个事件作出自定义的反应。</li>
        <li style="background-color: inherit;">BundleContext：一个bundle在框架中的执行时上下文，这个上下文提供了和框架进行交互的方法。</li>
        <li style="background-color: inherit;">
            Bundle：在逻辑上表示了一个bundle，OSGi环境中的一个物理bundle对应了一个bundle对象。该对象中包含了bundle的基本信息和bundle生命周期的控制接口。
        </li>
    </ul>
</div>
<br style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-align: right;">
    <a style="background-color: inherit; cursor: pointer;"
       href="http://www.cnblogs.com/jingmoxukong/p/4546947.html#_labelTop">回到顶部</a></div>
<h1 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: inherit;"><span
            style="background-color: inherit; color: rgb(255, 102, 0); font-size: 18pt;">服务层</span></strong></h1>
<hr style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    一个OSGi 服务就是注册到 OSGi 框架中的一个 Java 对象。注册的时候可以设置这个 Service 的属性。而在获取 Service的时候可以根据属性进行过滤。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    Bundle 可以通过 Bundle的上下文去注册Service或去查询Service。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    一个提供服务的bundle可以发布POJO作为服务的实体；一个使用服务的bundle可以通过这个注册表找到和绑定服务。&nbsp;<span
        class="Apple-converted-space">&nbsp;</span><br style="background-color: inherit;"></p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <img style="background-color: inherit; cursor: default; display: inline-block; margin-top: 8px; max-width: 800px;"
         data-attr-org-img-file="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/f408847fbe334b168aeacdfc446c35eb/service1.png"
         data-attr-org-src-id="599A235324C04EF1BD7F504FD4C2B7C9" data-media-type="image"
         alt="http://assets.osgi.com.cn/article/7289220/service1.PNG"
         src="file:///C:/Users/ZaoSheng/AppData/Local/YNote/data/zzs99@126.com/f408847fbe334b168aeacdfc446c35eb/service1.png">
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    &nbsp;</p>

<h2 style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <span style="background-color: inherit; color: rgb(51, 102, 255); font-size: 14pt;">发布服务</span></h2>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    为了让别的bundle能发现这个服务，你必须在发布它之前对其进行特征描述。这些特征包括接口的名字（可以是名字的数组），接口的实现，和一个可选的java.util.Dictionary类型的元数据信息。
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <strong style="background-color: rgb(192, 192, 192);">例</strong><br style="background-color: rgb(192, 192, 192);">
</p>

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    String[]&nbsp;interfaces&nbsp;=&nbsp;&nbsp;<span
        style="background-color: inherit; color: rgb(0, 0, 255);">new</span>&nbsp;String[]{StockListing.<span
        style="background-color: inherit; color: rgb(0, 0, 255);">class</span>.getName(),&nbsp;StockChart.<span
        style="background-color: inherit; color: rgb(0, 0, 255);">class</span>.getname()};&nbsp;&nbsp;<br
        style="background-color: inherit;">Dictionary&nbsp;metadata&nbsp;=&nbsp;&nbsp;<span
        style="background-color: inherit; color: rgb(0, 0, 255);">new</span>&nbsp;Properties();&nbsp;&nbsp;<br
        style="background-color: inherit;">metadata.setProperty(“name”,&nbsp;“LSE”);&nbsp;&nbsp;<br
        style="background-color: inherit;">metadata.setProperty(“currency”,&nbsp;Currency.getInstance(“GBP”));&nbsp;&nbsp;<br
        style="background-color: inherit;">metadata.setProperty(“country”,&nbsp;“GB”);&nbsp;&nbsp;<br
        style="background-color: inherit;">ServiceRegistration&nbsp;registration&nbsp;=&nbsp;bundleContext.registerService(interfaces,&nbsp;<span
        style="background-color: inherit; color: rgb(0, 0, 255);">new</span>&nbsp;LSE(),&nbsp;metadata);&nbsp;</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    在上面的代码中，我们得到了<span class="Apple-converted-space">&nbsp;</span><strong
        style="background-color: inherit; color: rgb(128, 0, 0);">ServiceRegistration</strong><span
        class="Apple-converted-space">&nbsp;</span>对象，我们可以用这个对象来更新服务的元数据：<br style="background-color: inherit;">

    <div style="background-color: inherit;">registration.setProperties(newMetadata);</div>
    也可以直接就把这个服务移除：<br style="background-color: inherit;">

    <div style="background-color: inherit;">registration.unregister();</div>
    需要注意的是这个对象不能和其他 Bundle 共享，因为它和发布服务的bundle的生命周期相互依存。
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    也就是说，如果这个 Bundle 已经不在框架执行环境中存在，那么这个对象也不应该存在了，“皮之不存毛将焉附”就是这个道理。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    试 想如果这个 ServiceRegistration 共享给了其他的 bundle（具体的说就是其他bundle中存在对这个对象的引用），那么发布服务的那个bundle即使被移除了，由于其他bundle中的引用依然
    存在，那么垃圾处理机制不会抹去这个对象，这样不但于理不合，而且实际上这个对象也是不可用的，因为这个对象所依存的bundle已经不在了。<br style="background-color: inherit;">代码中的参数new
    LSE()是一个POJO，这个对象不需要实现任何OSGi类型或者使用标注，只要满足服务约定（这里就是接口）就可以了。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    此外，如果在删除发布的服务之前bundle停止了，框架会帮助你删除这些服务。<span class="Apple-converted-space">&nbsp;</span><br
        style="background-color: inherit;"></p><br
        style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">

<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    <h2 style="background-color: inherit;"><span
            style="background-color: inherit; color: rgb(51, 102, 255); font-size: 14pt;">发现和绑定服务</span></h2></div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    以下是一个根据实现的接口名称获得的服务的最简单方法：
</div>
<div style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    ServiceReference&nbsp;reference&nbsp;=&nbsp;&nbsp;<br style="background-color: inherit;">bundleContext.getServiceReference(StockListing.<span
        style="background-color: inherit; color: rgb(0, 0, 255);">class</span>.getName());
</div>
<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    注意这里的reference是服务对象的间接引用，可是为什么要用间接引用而不直接返回那个实际的服务对象呢？</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    实际上是为了将服务的使用和服务的实现进行解耦，将服务注册表作为两者的中间人，达到跟踪和控制服务的目的，同时还可以在服务消失了以后通知使用者。</p>

<p style="margin: 5px 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
    这个方法的返回类型是ServiceReference，它可以在bundle之间互享，因为它和使用服务的bundle的生命周期无关。<span class="Apple-converted-space"> <br></span>
</p>